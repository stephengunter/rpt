import{_ as ge}from"./Date-e8692911.js";import{c as i,aO as he,o as ae,e as h,f as I,j as n,F as le,p as se,t as g,h as Q,w as f,g as u,q as $,I as ne,v as B,a8 as oe,i as ye,k as M,bi as be,bj as Ve,O as Ie,u as Ee,a as De,b as Te,r as Ue,d as H,K as je,aV as xe,a2 as X,aW as Z,bk as we,_ as R,a7 as L,V as Se,l as Oe,E as Ne,a_ as ke,bl as Fe,a6 as Ce,bm as Re,b6 as Le,bn as Je,aU as ee}from"./index-c3e40adb.js";import{J as v,_ as $e,c as J}from"./VSelect-1b8c99bf.js";import{V as Be}from"./validate.types-512aac96.js";import{V as te,a as S}from"./VRow-39a21267.js";import{V as D}from"./VTextField-e1b68920.js";const Me={key:0},Ae={class:"text-error",style:{"list-style-type":"disc !important"}},Pe={__name:"Result",props:{result:{type:Object,default:null}},emits:["find"],setup(T,{emit:r}){const O=r,V=T,N=i(()=>V.result?!he(V.result.errors):!1);i(()=>N.value?V.result.errors.hasOwnProperty("duplicate"):!1),ae(()=>{});function o(){O("find",V.result.id)}return(A,y)=>N.value?(h(),I("div",Me,[n("ul",Ae,[(h(!0),I(le,null,se(Object.entries(T.result.errors),([E,U])=>(h(),I("li",{key:E},g(U),1))),128))]),T.result.errors.hasOwnProperty("duplicate")?(h(),Q(oe,{key:0,text:"查詢"},{activator:f(({props:E})=>[u($,ne({class:"mb-1",icon:"mdi-magnify"},E,{size:"x-small",color:"info",onClick:B(o,["prevent"])}),null,16)]),_:1})):ye("",!0)])):(h(),Q(Ie,{key:1,icon:M(be)[M(Ve)],color:"success"},null,8,["icon"]))}},Ge={class:"text-center",style:{width:"10%"}},Ke={class:"text-center",style:{width:"10%"}},Ye={class:"text-center",style:{width:"8%"}},qe={class:"text-center",style:{width:"10%"}},ze={class:"text-center",style:{width:"20%"}},We={class:"text-center",style:{width:"10%"}},Qe={class:"text-center",style:{width:"12%"}},He={class:"text-center",style:{width:"10%"}},Xe={class:"text-center",style:{width:"12%"}},Ze=n("th",{class:"text-center"}," 備註 ",-1),ut={__name:"Upload",setup(T){const r=Ee();De();const O=Te(),V=Ne.JUDGEBOOKFILE,o=Ue(H({type:null,courtType:null,department:null,options:{department:[]},models:[],date:{id:1001,title:"",active:!1,value:"",model:{text:"",text_cn:"",num:0},error_message:""}})),A=je(null),y=i(()=>r.state.files_judgebooks.params),E=i(()=>r.state.files_judgebooks.ad_dpts),U=i(()=>r.state.files_judgebooks.allowEmptyJudgeDate),ue=i(()=>r.state.files_judgebooks.allowEmptyFileNumber),j=i(()=>r.state.files_judgebooks.types),k=i(()=>r.state.files_judgebooks.departments),F=i(()=>r.state.files_judgebooks.courtTypes),re=i(()=>r.state.files_judgebooks.originTypes),d=i(()=>r.state.files_judgebooks.labels),ie=i(()=>j.value.map(e=>({value:e.id,title:e.title}))),x=i(()=>r.state.files_judgebooks.upload.results),de=i(()=>o.models.length?o.models.map(e=>e.errors.any()).some(e=>e===!0):!1);ae(()=>{j.value.length&&k.value.length?P():r.dispatch(xe).then(()=>{X(P)}).catch(e=>Z(e))});function P(){r.commit(we,[]),y.value.typeId?o.type=j.value.find(s=>s.id===y.value.typeId):o.type=j.value[0],y.value.courtType?o.courtType=F.value.find(s=>s.value===y.value.courtType):o.courtType=F.value[0];const e=w(o.courtType.value),a=y.value.departmentId;a?o.department=e.find(s=>s.value===a):o.department=e[0]}function G(){O.push({name:ke.JUDGEBOOKFILES,query:{...y.value}})}function w(e){return e=e?e.toLowerCase():"",k.value.hasOwnProperty(e)?k.value[e].options:[]}function ce(e){let a=w(e.courtType);a.findIndex(c=>c.value===e.departmentId)<0&&(e.departmentId=a[0].value)}function pe(e){const a=e.departmentId;if(a){const c=w(e.courtType).find(b=>b.value===a);e.department=c,e.departmentId=a}else e.department=null,e.departmentId=null}function me(e,a,s,c,b,t){if(e.type==="application/pdf"||e.name.toLowerCase().endsWith(".pdf")){const l="";let C=e.name.slice(0,-4),p="",q="",z="",W="",_=C.split("_");return _.length>=3&&(q=_[1],z=v.checkNum(_[2]),v.checkYear(_[0])&&(p=_[0]),_.length>3&&(Je(ee(_[3]))?c=ee(_[3]):W=_[3].toString())),new v(a,s,c,l,t,b,p,q,z,e,W)}return null}function K(e){const a=o.type,s=o.courtType.value,c=o.department,b=re.value[0].value,t=0;let l=-1;o.models=[],e.forEach(C=>{let p=me(C,c,a,t,s,b);p&&(m(p,"fileNumber"),m(p,"judgeDate"),m(p,"year"),m(p,"category"),m(p,"num"),p.id=l,o.models.push(p),l-=1)})}function m(e,a){let s=!1;if(a==="fileNumber"?e[a]?s=v.checkFileNumber(e[a]):s=ue.value:a==="judgeDate"?e[a]?s=v.checkJudgeDate(e[a]):s=U.value:a==="year"?s=v.checkYear(e[a]):a==="category"?s=!Fe(e[a]):a==="num"?s=!!v.checkNum(e[a]):s=!0,s)e.errors.clear(a);else{let c=e[a]?`${d.value[a]}不正確`:Be.REQUIRED(d.value[a]);e.errors.set(a,[c])}}function Y(e,{date:a,model:s}){a?(e.judgeDateModel.date=a,e.judgeDateModel.value=s.text_cn,e.judgeDateModel.model=H(s),e.judgeDate=s.num):(e.judgeDate=0,e.judgeDateModel=v.iniJudgeDateModel()),m(e,"judgeDate")}function fe(){o.models.forEach(e=>e.num=v.checkNum(e.num)),r.commit(Ce),r.dispatch(Re,o.models).then(e=>{X(()=>{r.state.files_judgebooks.upload.has_error||(Le(),G())})}).catch(e=>Z(e))}function _e(e){return x.value.length?x.value.find(a=>a.id===e.id):null}function ve(e){const a=o.models.find(s=>s.id===e);emit("find",a)}return(e,a)=>{const s=$e,c=Pe,b=ge;return h(),I("div",null,[u(te,{dense:""},{default:f(()=>[u(S,{cols:"11"},{default:f(()=>[u(s,{ref_key:"file_upload",ref:A,multiple:!0,show_button:!0,is_media:!1,allow_types:[".pdf"],onFileAdded:K,onFileRemoved:K},null,512)]),_:1}),u(S,{cols:"1"},{default:f(()=>[u(oe,{text:`返回${M(V).title}管理`},{activator:f(({props:t})=>[u($,ne({class:"float-right",icon:"mdi-arrow-left-bold"},t,{size:"small",color:"info",onClick:B(G,["prevent"])}),null,16)]),_:1},8,["text"])]),_:1})]),_:1}),R(u(te,{dense:""},{default:f(()=>[u(S,{cols:"12"},{default:f(()=>[u(Se,null,{default:f(()=>[n("thead",null,[n("tr",null,[R(n("th",Ge,null,512),[[L,x.value.length]]),n("th",Ke,g(d.value.typeId),1),n("th",Ye,g(d.value.courtType),1),n("th",qe,g(d.value.dpt),1),n("th",ze,g(d.value.fileNumber),1),n("th",We,g(d.value.year),1),n("th",Qe,g(d.value.category),1),n("th",He,g(d.value.num),1),n("th",Xe,g(d.value.judgeDate),1),Ze])]),n("tbody",null,[(h(!0),I(le,null,se(o.models,t=>(h(),I("tr",{key:t.id},[R(n("td",null,[u(c,{result:_e(t),onFind:ve},null,8,["result"])],512),[[L,x.value.length]]),n("td",null,[u(J,{class:"mt-3",label:d.value.typeId,density:"compact",variant:"outlined",items:ie.value,modelValue:t.typeId,"onUpdate:modelValue":l=>t.typeId=l},null,8,["label","items","modelValue","onUpdate:modelValue"])]),n("td",null,[u(J,{class:"mt-3",label:d.value.courtType,density:"compact",variant:"outlined",items:F.value,modelValue:t.courtType,"onUpdate:modelValue":[l=>t.courtType=l,l=>ce(t)]},null,8,["label","items","modelValue","onUpdate:modelValue"])]),n("td",null,[u(J,{class:"mt-3",label:d.value.dpt,density:"compact",variant:"outlined",clearable:E.value.length===0,items:w(t.courtType),modelValue:t.departmentId,"onUpdate:modelValue":[l=>t.departmentId=l,l=>pe(t)]},null,8,["label","clearable","items","modelValue","onUpdate:modelValue"])]),n("td",null,[u(D,{variant:"outlined",class:"pt-3",density:"compact",modelValue:t.fileNumber,"onUpdate:modelValue":l=>t.fileNumber=l,"error-messages":t.errors.get("fileNumber"),onInput:l=>m(t,"fileNumber")},null,8,["modelValue","onUpdate:modelValue","error-messages","onInput"])]),n("td",null,[u(D,{variant:"outlined",class:"pt-3",density:"compact",modelValue:t.year,"onUpdate:modelValue":l=>t.year=l,"error-messages":t.errors.get("year"),onInput:l=>m(t,"year")},null,8,["modelValue","onUpdate:modelValue","error-messages","onInput"])]),n("td",null,[u(D,{variant:"outlined",class:"pt-3",density:"compact",modelValue:t.category,"onUpdate:modelValue":l=>t.category=l,"error-messages":t.errors.get("category"),onInput:l=>m(t,"category")},null,8,["modelValue","onUpdate:modelValue","error-messages","onInput"])]),n("td",null,[u(D,{variant:"outlined",class:"pt-3",density:"compact",modelValue:t.num,"onUpdate:modelValue":l=>t.num=l,"error-messages":t.errors.get("num"),onInput:l=>m(t,"num")},null,8,["modelValue","onUpdate:modelValue","error-messages","onInput"])]),n("td",null,[u(b,{class_name:"pt-3",clearable:U.value,label:"",error_message:t.errors.get("judgeDate"),date:t.judgeDateModel.date,value:t.judgeDateModel.value,onReady:l=>Y(t,l),onSelected:l=>Y(t,l)},null,8,["clearable","error_message","date","value","onReady","onSelected"])]),n("td",null,[u(D,{variant:"outlined",class:"pt-3",density:"compact",modelValue:t.ps,"onUpdate:modelValue":l=>t.ps=l},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])]),_:1})]),_:1}),u(S,{cols:"12"},{default:f(()=>[u($,{color:"success",class:"float-right",disabled:o.models.length===0||de.value,onClick:B(fe,["prevent"])},{default:f(()=>[Oe(" 確定 ")]),_:1},8,["disabled"])]),_:1})]),_:1},512),[[L,o.models.length]])])}}};export{ut as default};
